# 2019-2학기 시스템 프로그래밍 팀 프로젝트

Smart Locker - 1조 김영진, 강현구, 윤준성

## 프로젝트 개요

불편한 학교 사물함을 개선하고자 개발을 하게 되었으며 학교 사물함이 공간을 많이 차지하고 한정된 수의 학생들만 사물함을 사용할 수 있는 것에 착안해서 개발함

따라서 자물쇠로 잠그는 사물함에서 벗어나 좀 더 편리하게 사물함을 사용할 수 있게 비밀번호를 사용해 보안을 강화하고 편리성을 생각했으며  회전식으로 사물함을 개발함으로써 공간의 효율성을 고려하여 개발하고자 하였다.

## 프로젝트 시나리오

### 처음 사용자 시나리오

![image](https://user-images.githubusercontent.com/52458791/97527204-10d16000-19ee-11eb-8805-e4f54a9267ca.png)

### 기존 사용자 시나리오

<img src="https://user-images.githubusercontent.com/52458791/97527208-1464e700-19ee-11eb-9789-63be57ca2b3f.png" alt="image" style="zoom:80%;" />

## 시스템 구조

### 하드웨어 구조

![image](https://user-images.githubusercontent.com/52458791/97527357-7291ca00-19ee-11eb-8c94-cf8ba44b7ed0.png)

### 소프트웨어 구조

![image](https://user-images.githubusercontent.com/52458791/97527381-80474f80-19ee-11eb-9ac3-692f9610785a.png)

하드웨어 구조가 동작을 수행할 수 있도록 구현될 소프트웨어 구조도이다. 사용자가 시스템과 상호작용하는 RBP1, 모터를 동작시켜서 방을 회전시키는 RBP2로 구성되며 두 라즈베리파이는 소켓통신으로 통신한다. 초음파센서와 키패드, 그리고 마그네틱 센서와 RGB와 서보모터는 디바이스 드라이버로 구현되어있으며, LCD의 경우에는 WiringPi로 구현되었다. 스피커 기능은 별도의 라이브러리를 사용하여 구현하였다. 

 RBP1 에서는 사용자와 상호작용할 키패드 드라이버, 사용자가 앞에 있는지 감지할 초음파센서 드라이버, 방에 여유가 있는지 알려주고 개폐여부를 알려주는 LED드라이버, 문의 개폐여부를 감지하는 마그네틱센서 드라이버 그리고 도어락을 제어할 모터 드라이버가 구현되어있다. LCD의 경우에는 WiringP로 애플리케이션 파일에서 구동되며 스피커의 경우 별도 라이브러리로 구현되었다. 키패드를 통해 사용자의 입력을 받고 이에 따라 음성으로 사용자에게 안내메세지를 출력하거나, RBP2에 메시지를 보내서 방을 제어하는 역할을 한다.

 RBP2에서는 방을 회전할 서보 모터 디바이스 드라이버와 이를 실행시킬 응용프로그램이 구현되었다. RBP1에서 값을 전달받아서 그것을 해석한 뒤 회전시킬 방과 층을 판단한다. 그 다음 해당 층의 방이 문 앞으로 오도록 회전시킨다. 

## 프로그램 구동

![image](https://user-images.githubusercontent.com/52458791/97527409-9228f280-19ee-11eb-88a6-e7ef0e86a3ff.png)

각 디바이스 드라이버를 make를 해줘야 한다(각 폴더의 Makefile에 컴파일 및 디바이스 드라이버 모듈설치 등 필요한 명령어 다 넣어줌). 또한 리눅스 커널을 이용하였기에 리눅스 헤더파일을 미리 설치해주어야 하며 mpg321프로그램 또한 mp3파일 실행을 위해 미리 설치가 필요하다. 이외에는 위에 보이는 것과 똑같이 디렉토리 및 파일을 위치해주고 app파일을 gcc컴파일을 해주면 되고 소켓 통신을 위해서는 서버와 클라이언트 앱에서 IP주소 및 포트 번호를 통일시켜주어야 한다. RBP2 컴파일시 main.c 와 rotate.c를 링크하여 gcc컴파일을 해야한다.
